<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .line {
      display:flex;
      flex-direction: row;
    }

    .invisible {
      visibility: hidden;
    }

    .visible {
      visibility:visible;
    }
    
    .square {
      background-color: white;
      width: 50px;
      height: 50px;
      border: 1px solid black;
      cursor: pointer;
      display: flex;
      flex-direction:row;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <div id="form">
    P1: <select id="symbolP1">
      <option value="X">X</option>
      <option value="O">O</option>
    </select>
    &nbsp;
    P2: <select id="symbolP2">
      <option value="X">X</option>
      <option value="O">O</option>
    </select>
    <button id="game">Iniciar</button>
  </div>
  <div id="container" class="invisible">
    <div id="table">
      <div id="line1" class="line"></div>
      <div id="line2" class="line"></div>
      <div id="line3" class="line"></div>  
    </div>
    <div id="panel" class="line">
      <span id="span-panel"></span>
    </div>  
  </div>

  <script type="module">
    import ticTacToe from './src/ticTacToe.js';
    
    let player = '';
    let p1 = '';
    let p2 = '';
    const container = document.querySelector('#container');
    const spanPanel = document.querySelector('#span-panel');
    const gameBtn = document.querySelector('#game');
    let game = null;
    
    const showPlayer = (player) => {
      spanPanel.innerHTML = '';
      const playerHead3 = document.createElement('h3');
      playerHead3.textContent = player.toUpperCase();
      spanPanel.appendChild(playerHead3);
    };

    const fillSquareWithSymbol = (symbol) => {
      const playerHead = document.createElement('h1');
      playerHead.textContent = symbol.toUpperCase();
      return playerHead;
    };

    const startGame = () => {
      p1 = document.querySelector('#symbolP1').value;
      p2 = document.querySelector('#symbolP2').value;

      if(p1 === p2) return alert('Não é possivel começar o jogo sem que os jogadores escolham o simbolo que vão usar');

      cleanTable();

      gameBtn.setAttribute('disabled', false);

      newGame();
    
      gameBtn.setAttribute('disabled', true);

      player = chooseWhoBegins();

      showPlayer(player);
    };

    const cleanTable = () => {
      const divsSqaure = document.querySelectorAll('.square');
      divsSqaure.forEach((item) => {
        item.textContent = '';
        item.addEventListener('click', movePlayer);
      });

      game = null;
    };

    const newGame = () => {
      game = ticTacToe();

      container.classList.remove('invisible');
    };

    const chooseWhoBegins = () => {};

    const movePlayer = (event) => {
      const symbol = (player === 'p1') ? p1 : p2;
      const divSquare = document.querySelector('#'+ event.target.id);
      divSquare.removeEventListener('click', movePlayer);
      divSquare.disabled = true;
      divSquare.appendChild(fillSquareWithSymbol(symbol));
      game.move(symbol, event.target.id);
      if(typeof game.isFinish() === 'object'){
        const finish = game.isFinish();
        showPlayer(`${(finish.rule !== 'Draw') ? player+' Ganhou' : 'Empatou'}`)
        const divsSqaure = document.querySelectorAll('.square');
        divsSqaure.forEach((item) => {
          item.removeEventListener('click', movePlayer);
        });
        gameBtn.removeAttribute('disabled');
        return;
      }
      player = (player === 'p1')? 'p2' : 'p1';
      showPlayer(player);
    }

    const createDiv = (id) => {
      const div = document.createElement('div');
      div.id = id;
      div.classList.add('square');
      div.addEventListener('click', movePlayer);
      return div;
    }

    document.addEventListener('click', (event) => {
      if(event.target.id === 'game') startGame();
    });

    document.addEventListener('DOMContentLoaded', () => {
      const line1 = document.querySelector('#line1');
      const line2 = document.querySelector('#line2');
      const line3 = document.querySelector('#line3');


      line1.appendChild(createDiv('p1'));
      line1.appendChild(createDiv('p2'));
      line1.appendChild(createDiv('p3'));

      line2.appendChild(createDiv('p4'));
      line2.appendChild(createDiv('p5'));
      line2.appendChild(createDiv('p6'));

      line3.appendChild(createDiv('p7'));
      line3.appendChild(createDiv('p8'));
      line3.appendChild(createDiv('p9'));
    });
  </script>
  
</body>
</html>